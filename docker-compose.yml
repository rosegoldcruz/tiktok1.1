version: '3.8'

services:
  trend_monitor:
    build: .
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - PYTHONUNBUFFERED=1
    command: python trend_monitor_async.py
    depends_on:
      - prometheus

  prompt_engine:
    build: .
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - PYTHONUNBUFFERED=1
    command: python prompt_engine.py
    depends_on:
      - trend_monitor

  content_generator:
    build: .
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - PYTHONUNBUFFERED=1
    command: python content_generator.py
    depends_on:
      - prompt_engine
      
  performance_logger:
    build: .
    volumes:
      - ./data:/app/data
      - ./.env:/app/.env
    environment:
      - PYTHONUNBUFFERED=1
    command: python performance_logger.py
    depends_on:
      - content_generator

  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
      
  grafana:
    image: grafana/grafana
    ports:
      - "3000:3000"
    volumes:
      - grafana-storage:/var/lib/grafana
    depends_on:
      - prometheus

volumes:
  grafana-storage: